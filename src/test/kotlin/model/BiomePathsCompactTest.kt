/*
 * ONI Seed Browser
 * Copyright (C) 2025 Stefan Oltmann
 * https://stefan-oltmann.de
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

package model

import kotlin.test.Test
import kotlin.test.assertEquals

class BiomePathsCompactTest {

    @Test
    fun testBiomePathConversion() {

        assertEquals(
            expected = 3776,
            actual = rawBiomePathsString.length
        )

        val biomePaths = BiomePaths.parse(rawBiomePathsString)

        val deltas = BiomePathsCompact.fromBiomePaths(biomePaths)

        val actualString = deltas.serialize()

        assertEquals(compactBiomePathsString, actualString)

        assertEquals(
            expected = 3156,
            actual = actualString.length
        )

        val restored = BiomePathsCompact.toBiomePaths(deltas)

        assertEquals(biomePaths, restored)
    }

    @Test
    fun testParseFrom() {

        val biomePaths = BiomePathsCompact.parse(compactBiomePathsString)

        val actual = biomePaths.serialize()

        assertEquals(
            expected = compactBiomePathsString,
            actual = actual
        )
    }

    companion object {

        val rawBiomePathsString = """
            Sandstone:136,197 144,180 139,161 122,151 103,157 93,174 94,188 111,204;39,286 30,265 0,268 0,293 30,296;94,188 93,174 75,167 71,169 68,193 72,198;103,157 93,143 85,144 75,167 93,174;122,151 123,142 104,131 93,143 103,157;145,213 145,208 136,197 111,204 111,212 124,223;150,154 151,142 138,132 123,142 122,151 139,161;168,193 164,182 144,180 136,197 145,208;169,168 150,154 139,161 144,180 164,182
            MagmaCore:31,353 0,345 0,380 32,380;52,160 47,142 36,138 20,155 25,170 33,174;61,351 42,343 31,353 32,380 61,380;73,344 73,332 60,319 41,326 42,343 61,351;92,356 73,344 61,351 61,380 92,380;93,319 91,302 90,301 64,306 60,319 73,332;122,350 113,344 92,356 92,380 123,380;117,298 122,282 104,271 90,280 90,301 91,302;126,313 117,298 91,302 93,319 111,330;130,278 133,252 124,246 106,253 104,271 122,282;153,353 143,345 122,350 123,380 152,380;177,345 173,327 148,324 143,345 153,353;181,347 177,345 153,353 152,380 183,380;211,349 206,343 181,347 183,380 208,380;240,348 240,327 209,328 206,343 211,349;211,299 202,284 194,283 178,300 183,313 203,316;214,238 205,222 185,222 182,226 190,254 204,255;215,157 205,138 187,142 183,162 202,174;240,348 211,349 208,380 240,380
            OilField:33,320 30,296 0,293 0,330;42,343 41,326 33,320 0,330 0,345 31,353;60,319 64,306 52,287 39,286 30,296 33,320 41,326;113,344 111,330 93,319 73,332 73,344 92,356;143,345 148,324 143,316 126,313 111,330 113,344 122,350;183,313 178,300 155,292 143,316 148,324 173,327;206,343 209,328 203,316 183,313 173,327 177,345 181,347;240,327 240,299 211,299 203,316 209,328
            FrozenWastes:30,265 34,255 23,233 0,233 0,268;69,268 66,256 59,250 34,255 30,265 39,286 52,287;153,103 154,85 138,73 120,85 120,104 138,113;182,263 190,254 182,226 160,231 154,247 167,263;240,299 240,271 211,270 202,284 211,299;240,184 240,159 215,157 202,174 204,184 212,191
            Wasteland:36,216 33,203 0,200 0,233 23,233;68,193 71,169 52,160 33,174 38,193;54,106 62,76 61,74 34,72 24,90 36,108;111,212 111,204 94,188 72,198 72,214 90,226;93,143 104,131 103,114 88,106 67,118 67,128 85,144;216,205 212,191 204,184 180,199 185,222 205,222
            SugarWoods:38,193 33,174 25,170 0,179 0,200 33,203;29,122 36,108 24,90 0,90 0,122;104,271 106,253 91,242 66,256 69,268 90,280;88,106 87,85 62,76 54,106 67,118;120,104 120,85 101,74 87,85 88,106 103,114;167,263 154,247 133,252 130,278 153,287;240,126 212,126 205,138 215,157 240,159
            Radioactive:25,170 20,155 0,151 0,179;211,270 204,255 190,254 182,263 194,283 202,284;240,184 212,191 216,205 240,208
            BoggyMarsh:36,138 29,122 0,122 0,151 20,155;72,214 72,198 68,193 38,193 33,203 36,216 58,224;91,242 90,226 72,214 58,224 59,250 66,256;138,132 138,113 120,104 103,114 104,131 123,142;154,247 160,231 145,213 124,223 124,246 133,252;186,106 182,77 178,74 154,85 153,103 174,115;205,138 212,126 205,111 186,106 174,115 173,129 187,142
            Barren:24,90 34,72 27,58 0,56 0,90;65,59 45,36 39,36 27,58 34,72 61,74;101,74 100,61 85,49 65,59 61,74 62,76 87,85;138,73 138,60 120,47 100,61 101,74 120,85;178,74 175,59 156,48 138,60 138,73 154,85;207,73 213,60 200,37 197,37 175,59 178,74 182,77;240,57 213,60 207,73 219,92 240,93
            Ocean:59,250 58,224 36,216 23,233 34,255;67,128 67,118 54,106 36,108 29,122 36,138 47,142;90,301 90,280 69,268 52,287 64,306;155,292 153,287 130,278 122,282 117,298 126,313 143,316;194,283 182,263 167,263 153,287 155,292 178,300;219,92 207,73 182,77 186,106 205,111;240,208 216,205 205,222 214,238 240,239
            ToxicJungle:75,167 85,144 67,128 47,142 52,160 71,169;124,246 124,223 111,212 90,226 91,242 106,253;173,129 174,115 153,103 138,113 138,132 151,142;182,226 185,222 180,199 168,193 145,208 145,213 160,231;183,162 187,142 173,129 151,142 150,154 169,168;204,184 202,174 183,162 169,168 164,182 168,193 180,199;240,239 214,238 204,255 211,270 240,271;240,93 219,92 205,111 212,126 240,126
        """.trimIndent()

        val compactBiomePathsString = """
            3:136,197 8,-17 -5,-19 -17,-10 -19,6 -10,17 1,14 17,16|39,286 -9,-21 -30,3 0,25 30,3|94,188 -1,-14 -18,-7 -4,2 -3,24 4,5|103,157 -10,-14 -8,1 -10,23 18,7|122,151 1,-9 -19,-11 -11,12 10,14|145,213 0,-5 -9,-11 -25,7 0,8 13,11|150,154 1,-12 -13,-10 -15,10 -1,9 17,10|168,193 -4,-11 -20,-2 -8,17 9,11|169,168 -19,-14 -11,7 5,19 20,2
            5:31,353 -31,-8 0,35 32,0|52,160 -5,-18 -11,-4 -16,17 5,15 8,4|61,351 -19,-8 -11,10 1,27 29,0|73,344 0,-12 -13,-13 -19,7 1,17 19,8|92,356 -19,-12 -12,7 0,29 31,0|93,319 -2,-17 -1,-1 -26,5 -4,13 13,13|122,350 -9,-6 -21,12 0,24 31,0|117,298 5,-16 -18,-11 -14,9 0,21 1,1|126,313 -9,-15 -26,4 2,17 18,11|130,278 3,-26 -9,-6 -18,7 -2,18 18,11|153,353 -10,-8 -21,5 1,30 29,0|177,345 -4,-18 -25,-3 -5,21 10,8|181,347 -4,-2 -24,8 -1,27 31,0|211,349 -5,-6 -25,4 2,33 25,0|240,348 0,-21 -31,1 -3,15 5,6|211,299 -9,-15 -8,-1 -16,17 5,13 20,3|214,238 -9,-16 -20,0 -3,4 8,28 14,1|215,157 -10,-19 -18,4 -4,20 19,12|240,348 -29,1 -3,31 32,0
            6:33,320 -3,-24 -30,-3 0,37|42,343 -1,-17 -8,-6 -33,10 0,15 31,8|60,319 4,-13 -12,-19 -13,-1 -9,10 3,24 8,6|113,344 -2,-14 -18,-11 -20,13 0,12 19,12|143,345 5,-21 -5,-8 -17,-3 -15,17 2,14 9,6|183,313 -5,-13 -23,-8 -12,24 5,8 25,3|206,343 3,-15 -6,-12 -20,-3 -10,14 4,18 4,2|240,327 0,-28 -29,0 -8,17 6,12
            0:30,265 4,-10 -11,-22 -23,0 0,35|69,268 -3,-12 -7,-6 -25,5 -4,10 9,21 13,1|153,103 1,-18 -16,-12 -18,12 0,19 18,9|182,263 8,-9 -8,-28 -22,5 -6,16 13,16|240,299 0,-28 -29,-1 -9,14 9,15|240,184 0,-25 -25,-2 -13,17 2,10 8,7
            13:36,216 -3,-13 -33,-3 0,33 23,0|68,193 3,-24 -19,-9 -19,14 5,19|54,106 8,-30 -1,-2 -27,-2 -10,18 12,18|111,212 0,-8 -17,-16 -22,10 0,16 18,12|93,143 11,-12 -1,-17 -15,-8 -21,12 0,10 18,16|216,205 -4,-14 -8,-7 -24,15 5,23 20,0
            20:38,193 -5,-19 -8,-4 -25,9 0,21 33,3|29,122 7,-14 -12,-18 -24,0 0,32|104,271 2,-18 -15,-11 -25,14 3,12 21,12|88,106 -1,-21 -25,-9 -8,30 13,12|120,104 0,-19 -19,-11 -14,11 1,21 15,8|167,263 -13,-16 -21,5 -3,26 23,9|240,126 -28,0 -7,12 10,19 25,2
            11:25,170 -5,-15 -20,-4 0,28|211,270 -7,-15 -14,-1 -8,9 12,20 8,1|240,184 -28,7 4,14 24,3
            2:36,138 -7,-16 -29,0 0,29 20,4|72,214 0,-16 -4,-5 -30,0 -5,10 3,13 22,8|91,242 -1,-16 -18,-12 -14,10 1,26 7,6|138,132 0,-19 -18,-9 -17,10 1,17 19,11|154,247 6,-16 -15,-18 -21,10 0,23 9,6|186,106 -4,-29 -4,-3 -24,11 -1,18 21,12|205,138 7,-12 -7,-15 -19,-5 -12,9 -1,14 14,13
            16:24,90 10,-18 -7,-14 -27,-2 0,34|65,59 -20,-23 -6,0 -12,22 7,14 27,2|101,74 -1,-13 -15,-12 -20,10 -4,15 1,2 25,9|138,73 0,-13 -18,-13 -20,14 1,13 19,11|178,74 -3,-15 -19,-11 -18,12 0,13 16,12|207,73 6,-13 -13,-23 -3,0 -22,22 3,15 4,3|240,57 -27,3 -6,13 12,19 21,1
            8:59,250 -1,-26 -22,-8 -13,17 11,22|67,128 0,-10 -13,-12 -18,2 -7,14 7,16 11,4|90,301 0,-21 -21,-12 -17,19 12,19|155,292 -2,-5 -23,-9 -8,4 -5,16 9,15 17,3|194,283 -12,-20 -15,0 -14,24 2,5 23,8|219,92 -12,-19 -25,4 4,29 19,5|240,208 -24,-3 -11,17 9,16 26,1
            4:75,167 10,-23 -18,-16 -20,14 5,18 19,9|124,246 0,-23 -13,-11 -21,14 1,16 15,11|173,129 1,-14 -21,-12 -15,10 0,19 13,10|182,226 3,-4 -5,-23 -12,-6 -23,15 0,5 15,18|183,162 4,-20 -14,-13 -22,13 -1,12 19,14|204,184 -2,-10 -19,-12 -14,6 -5,14 4,11 12,6|240,239 -26,-1 -10,17 7,15 29,1|240,93 -21,-1 -14,19 7,15 28,0
        """.trimIndent()
    }
}
